---
title: "Data cleaning"
author: "Devinn Chi and Chris Lohmeier"
date: "2024-02-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning = FALSE, message = FALSE}
library(tidyverse)
library(dplyr)
library(readr)
library(jsonlite)
library(skimr)
library(lubridate)
```

```{r}
# Code to convert json to CSV

# steam <- fromJSON("..\\data\\data_raw\\steam.jsonmdb", simplifyDataFrame = TRUE)
# 
# write.csv(steam, "..\\data\\data_clean\\steam.jsonmdb")
```


# Reading in Data
```{r}
steamData <- read_csv("../data/data_clean/steam.csv")
```
# Overview of data
```{r}
skim(steamData)
steamData %>% pull(platforms) %>% unique()
```
> Findings:
1. Games limited to PC, Mac, and Linux
2. Nearly 34,000 different developers!
3. Data mostly complete aside from ratings - it would be good to see if this means that it is biased in any way

# cleaning data
```{r}
steamDataClean <- steamData %>% 
  select(-store_url, -store_promo_url, -...1, -image, -voiceovers, -achievements, -gfq_url, -gfq_difficulty_comment, -gfq_rating_comment, -gfq_length_comment, -stsp_owners, -stsp_mdntime, -hltb_url, -hltb_single, -hltb_complete, -meta_url, -igdb_url, -igdb_single, -igdb_complete, -published_meta, -published_hltb, -published_stsp, -published_igdb) %>% 
  mutate(
    full_price = full_price/100,
    discount = discount/100,
    current_price = current_price/100) %>% 
    filter(full_price <= 200) # Only 2 games with full_price > 199.99
```

# Wider dataset
```{r}
steamDataWide <- steamDataClean %>% 
  mutate(genres = str_split(genres, ",")) %>% 
  unnest() %>% 
  pivot_wider(names_from = genres, values_from = genres)

genres <- names(steamDataWide)[23:39]
for(n in genres) {
  steamDataWide <- steamDataWide %>% 
    mutate(genres[n] <-  !is.na(genres[n]))
} 
  
```


# Data Exploration
```{r}
# Density plot of prices
steamDataClean %>% 
ggplot() +
  geom_density(aes(x = full_price)) +
  theme_classic()

# Code for getting developer size
steamDataDevelopers <- steamDataClean %>% 
  group_by(developers) %>% 
  mutate(developer_size = n())

# This may not be a good measure for how well-reasourced a developer is - maybe sales data exists somewhere?
steamDataDevelopers %>% 
  group_by(developers) %>% 
  summarize(developer_size = n()) %>% 
  arrange(desc(developer_size))

ggplot(steamDataDevelopers) +
  geom_histogram(aes(x = developer_size))

ggplot(steamDataDevelopers) +
  geom_point(aes(x = developer_size, y = full_price))
  
```

# Devinn's Chunk
```{r, fig.width = 15}
# Price to popularity
steamDataPricetoPop <- steamDataClean %>% 
  select(full_price, igdb_popularity, genres) %>% 
  filter(full_price <= 70, genres %in% c("Adventure", "Casual", "Action", "Racing", "Indie", "RPG", "Simulation", "Strategy"))

  ggplot(steamDataPricetoPop) + 
  geom_point(aes(x = full_price, y = igdb_popularity)) + 
  stat_smooth(aes(x = full_price, y = igdb_popularity), method = "lm", se = TRUE) +
  facet_wrap(~genres, scales = 'free') + 
  labs(Title = "Price to Popularity", x = "Price", y = "Popularity (IGDB)") +
  theme_classic()


# Genre to price
steamDataGenretoPrice <- steamDataClean %>% 
  select(full_price, genres) %>% 
  filter(full_price <= 70, genres %in% c("Adventure", "Casual", "Action", "Racing", "Indie", "RPG", "Simulation", "Strategy")) %>% 
  group_by(genres) %>% 
  summarize(average_price = mean(full_price))

  ggplot(steamDataGenretoPrice) +
    geom_bar(aes(x = genres, y = average_price), stat = "identity") +
    labs(title = "Average Price per Genre", x = "Genre", y = "Average Price") +
  theme_classic()

```

# Chris's Chunk
```{r}
ggplot(steamDataClean) + 
  geom_boxplot(aes(x = platforms, y = full_price)) + 
  scale_y_continuous(limits = c(0, 50))

steamDataClean %>%  
  mutate(published_store = ymd(published_store)) %>%
  mutate(year = year(published_store)) %>% 
  group_by(year) %>% 
  summarize(avg_price = mean(full_price)) %>%
  ggplot() +
    geom_bar(aes(x = year, y = avg_price), stat = "identity")

steamDataClean %>%  
  mutate(published_store = ymd(published_store)) %>%
  mutate(year = year(published_store)) %>% 
  ggplot() +
    geom_boxplot(aes(x = year, y = full_price, group = year))
```

